var q = require('q'),
    buildOAuthClient = require('simple-oauth2');

module.exports = function(credentials) {
  var oauth = buildOAuthClient(credentials);

  return {
    getToken: function(username, password) {
      var deferred = q.defer();

      oauth.Password.getToken({
        username: username,
        password: password
      }, function(error, token) {
        if (error) {
          return deferred.reject(error);
        }

        accessToken = oauth.AccessToken.create(token);
        deferred.resolve(accessToken);
      });

      return deferred.promise;
    }
  }
}
