(function(){angular.module("crds-ajax-form",[])}).call(this),function(){angular.module("crds-ajax-form").directive("crdsAjaxFormSuccess",["$animate",function(e){return{require:"^crdsAjaxForm",restrict:"EA",scope:!0,terminal:!0,priority:1e3,transclude:"element",link:function(t,r,n,i,s){i.registerSuccess(function(){var t,n;return t=r.parent(),n=t.parent(),s(function(r){return e.enter(r,n,t)})})}}}])}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty;angular.module("crds-ajax-form").directive("crdsAjaxForm",["$timeout",function(r){return{restrict:"A",scope:!0,require:["crdsAjaxForm","form"],link:function(n,i,s,a){return new(function(){function o(){this.checkInputValid=e(this.checkInputValid,this),this.removeWatch=e(this.removeWatch,this),this.addWatch=e(this.addWatch,this),this.addAllWatches=e(this.addAllWatches,this),this.findParentElements=e(this.findParentElements,this),this.watchForm=e(this.watchForm,this),this.elements={},this.watches={},this.dirtyWatches={},r(function(e){return function(){return e.findParentElements(),e.addAllWatches(),e.watchForm()}}(this),0)}return o.elements=null,o.watches=null,o.dirtyWatches=null,o.prototype.watchForm=function(){return n.$watch(""+s.name,function(e){return function(r,n){var i,s,a;for(a in r)t.call(r,a)&&(s=r[a],a.match(/^\$/)||(n[a]||e.addWatch(a,s),i=!0));for(a in n)t.call(n,a)&&(s=n[a],a.match(/^\$/)||r[a]||e.removeWatch(a));return i?e.findParentElements():void 0}}(this),!0)},o.prototype.findParentElements=function(){var e,t,r,n,s,a;for(s=i[0].elements,a=[],r=0,n=s.length;n>r;r++)if(t=s[r],"hidden"!==t.type&&!this.elements[t.name]){for(e=angular.element(t);;)if(e=e.parent(),e.hasClass("form-group")||!e||0===e.length)break;a.push(e?this.elements[t.name]=e:void 0)}return a},o.prototype.addAllWatches=function(){var e,r,n,i;e=a[1],i=[];for(n in e)t.call(e,n)&&(r=e[n],n.match(/^\$/)||i.push(this.addWatch(n,r)));return i},o.prototype.addWatch=function(e){return this.watches[e]?void 0:(this.watches[e]=n.$watch(""+s.name+"['"+e+"'].$invalid",function(t){return function(){return t.checkInputValid(e)}}(this)),this.dirtyWatches[e]=n.$watch(""+s.name+"['"+e+"'].$dirty",function(t){return function(){return t.checkInputValid(e)}}(this)),this.checkInputValid(e))},o.prototype.removeWatch=function(e){return this.watches[e]&&this.watches[e](),this.dirtyWatches[e]&&this.dirtyWatches[e](),delete this.watches[e],delete this.dirtyWatches[e]},o.prototype.checkInputValid=function(e){var t;if(t=n[s.name][e],t&&t.$invalid&&t.$dirty){if(this.elements[e]&&this.elements[e].addClass("has-error"),this.elements[e])return this.elements[e].addClass("has-feedback")}else if(this.elements[e]&&this.elements[e].removeClass("has-error"),this.elements[e])return this.elements[e].removeClass("has-feedback")},o}())},controller:["$scope","$element","$attrs","$http",function(r,n,i,s){var a;return new(a=function(){function a(){this.registerSuccess=e(this.registerSuccess,this);var a,o,c,u,h,l;this.FORM_SUCCESS_MESSAGE="form.success",this.VALIDATION_ERROR_MESSAGE="form.validation.error",this.SERVER_ERROR_MESSAGE="form.server.error",c=[],this.form=r[i.name],this.hidden=function(){var e,t,r,i;for(r=n[0].elements,i=[],e=0,t=r.length;t>e;e++)h=r[e],"hidden"===h.type&&i.push(h);return i}(),l=function(e,t){return e.$setDirty(),e[t.param]?(e[t.param].$setValidity("server",!1,e),e[t.param].$setViewValue(e[t.param].$modelValue),c.push(t.param)):void 0},o=function(e,t){e[t].$setValidity("server",!0,e),e[t].$setPristine()},u=function(e){var r,n,i,s;if(e.$error){i=e.$error,s=[];for(r in i)t.call(i,r)&&(n=i[r],s.push(function(){var t,r,i;for(i=[],t=0,r=n.length;r>t;t++)h=n[t],i.push(h.$valid?void 0:e[h.$name].$setViewValue(e[h.$name].$modelValue));return i}()));return s}},a=function(e){var r,n;n=[];for(r in e)t.call(e,r)&&(h=e[r],n.push(r.match(/^\$/&&e[r].$valid&&e[r].$setPristine)?void 0:e[r].$setPristine()));return n},n.bind("submit",function(e){return function(t){var d,f,m,p,v,$,y,E,S,R;for(t.stopPropagation(),t.preventDefault(),p=r[i.name],a(p),$=0,E=c.length;E>$;$++)f=c[$],o(p,f);if(c=[],p.$valid){for(m=r.$eval(i.crdsAjaxForm)||{},R=e.hidden,y=0,S=R.length;S>y;y++)h=R[y],m[h.name]=h.value;if(v={method:i.method,url:i.action,data:m},i.enctype&&"application/x-www-form-urlencoded"!==i.enctype){if("application/json"!==i.enctype)return d="Ajax Form does not support "+i.enctype+" encoded forms",console.log(d),!1}else v.transformRequest=e.formUrlEncodedRequest;s(v).success(function(){e.successMessage?(e.successMessage(),n.remove()):r.$emit("notify.success",e.FORM_SUCCESS_MESSAGE),p.$setPristine()}).error(function(t,n){var i,s,a;if(400===n){if(r.$emit("notify.error",e.VALIDATION_ERROR_MESSAGE),t)for(s=0,a=t.length;a>s;s++)i=t[s],l(p,i)}else r.$emit("notify.error",e.SERVER_ERROR_MESSAGE)})}else r.$emit("notify.error",e.VALIDATION_ERROR_MESSAGE),u(p);return!1}}(this))}return a.successHandler=null,a.prototype.registerSuccess=function(e){return this.successMessage=e},a.prototype.formUrlEncodedRequest=function(e,r){var n,i,s,a;return n=r(),n["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8",angular.isObject(e)?(s=function(){var r;r=[];for(i in e)t.call(e,i)&&(a=e[i],r.push(encodeURIComponent(i)+"="+encodeURIComponent(a)));return r}(),s.join("&").replace(/%20/g,"+")):null!==e?e.toString():""},a}())}]}}])}.call(this);