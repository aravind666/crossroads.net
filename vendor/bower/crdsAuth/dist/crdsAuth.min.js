/* crdsAuth - 0.0.1
 * Crossroads authentication
 * https://your/lib/name/here
 */
(function(){angular.module("crdsAuth",["ngCookies"]).run(function(a){a.CONFIG={apiUrl:"https://my.crossroads.net/ministryplatform/oauth",clientId:"client",clientSecret:"secret"}}).run(function(a,b,c,d,e){e.authenticate()}),angular.module("crdsAuth").directive("authForm",function(){return{restrict:"EA",templateUrl:"login.html",controller:"LoginCtrl"}}),angular.module("crdsAuth").factory("Auth",function(a,b,c,d){var e,f,g,h,i;return e=a.get("auth"),i=function(){return c.path("/")},h=function(){return c.path("/")},g=function(){try{return e.access_token}catch(a){}},f=function(a){var c;"undefined"==typeof a&&(a=g()),b.defaults.headers.common.Authorization="Bearer "+a,c={method:"GET",url:d.CONFIG.apiUrl+"/me"},b(c).success(function(a){d.user=a}).error(function(a,b){0===b&&console.log("Could not reach API"),i()})},{authenticate:function(){return f()},getAccessToken:function(c,e){var g;g={client_id:d.CONFIG.clientId,client_secret:d.CONFIG.clientSecret,grant_type:"password",username:c,password:e},b({url:d.CONFIG.apiUrl+"/token",method:"POST",data:$.param(g),headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:null}}).success(function(b){console.log("Authentication Successful!"),a.put("auth",b),f(b.access_token),h()}).error(function(a,b){0===b?console.log("Could not reach API"):"invalid_grant"===a.error&&console.log("Invalid username & password")})},logout:function(){a.remove("auth")},redirectToLogin:function(){return i()},redirectToHome:function(){return h()}}}),angular.module("crdsAuth").controller("LoginCtrl",function(a,b){a.login=function(){b.getAccessToken(a.user.username,a.user.password)}})}).call(this),angular.module("crdsAuth").run(["$templateCache",function(a){a.put("login.html",'<div class="login col-md-12">\n  <div class="dd_menu">\n    <div class="primary">\n      <h3>Login</h3>\n      <form id="nav_login" role="form" ng-submit="login()">\n	<div class="form-group">\n	  <div class="input-group">\n	    <input class="form-control" type="text" name="userName" id="username_nav" placeholder="Username" ng-model="user.username">\n	    <span class="input-group-addon"><a href="#">@</a></span>\n	  </div>\n	  <div class="input-group">\n	    <input class="form-control" autocomplete="off" type="password" name="password" id="password_nav" placeholder="Password" ng-model="user.password">\n	    <span class="input-group-addon"> <a href="#">@</a></span>\n	  </div>\n	  <input type="submit" name="submit_nav" value="Login" id="submit_nav" class="col-md-12 btn submit" >\n	  <div style="font-size: smaller;">\n	    <input type="checkbox" name="remember" id="remember_nav">\n	    <label for="remember">Stay Logged In</label>\n	  </div>\n	</div>\n      </form>\n    </div>\n  </div>\n</div>\n')}]);