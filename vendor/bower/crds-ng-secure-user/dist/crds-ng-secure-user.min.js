(function(){angular.module("crdsSecureUser",["crdsAuth"])}).call(this),function(){var e=function(e,r){return function(){return e.apply(r,arguments)}};angular.module("crdsSecureUser").run(["SecureUser",function(e){return e.loadCurrentUser()}]).provider("SecureUser",function(){var r;console.log("SecureUser provider factory"),r=30,this.setSessionMinutes=function(e){return r=e},this.$get=["$rootScope","$localStorage","Auth",function(n,t,s){var o,u,i;return console.log("SecureUser.$get, using sessionMinutes "+r),i=new(function(){function n(){this.login=e(this.login,this),this.loadCurrentUser=e(this.loadCurrentUser,this),this.userId=null,this.user=null,this.loggedIn=null,this.seenDate=null}return n.prototype.loadCurrentUser=function(){var e,n,s;n=t.secureUser,n&&(s=new Date(t.seenDate),isNaN(s.getTime())?(console.log("User session date is invalid"),o()):(e=((new Date).getTime()-s.getTime())/1e3/60,r>=e?(this.user=n,this.userId=n.id,this.loggedIn=!0,this.seenDate=new Date):(console.log("User session has expired"),o()))),u()},n.prototype.login=function(e,r){var n;o(),this.loggedIn=null,n=s.login(e,r),n.then(u)},n.prototype.logout=function(){return o(),s.logout()},n}()),n.secureUser=i,u=function(){var e;return console.log("SecureUser.getCurrentUser"),e=s.getCurrentUser(),e.then(function(e){return e?(console.log("Received current user from Ministry Platform"),i.user=e,i.userId=e.id,i.loggedIn=!0,i.seenDate=new Date,t.secureUser=e,t.seenDate=i.seenDate):(console.log("No current user logged in to Ministry Platform"),o())})},o=function(){return i.userId=null,i.user=null,i.loggedIn=!1,i.seenDate=null,t.secureUser&&delete t.secureUser,t.seenDate?delete t.seenDate:void 0},i}]})}.call(this);