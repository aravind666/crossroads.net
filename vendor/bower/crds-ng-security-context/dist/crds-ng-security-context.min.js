(function(){angular.module("crdsSecurityContext",[])}).call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};angular.module("crdsSecurityContext").run(["SecurityContext",function(e){return e.loadCurrentUser()}]).provider("SecurityContext",function(){var t,n;t="Auth",n=30,this.getSessionMinutes=function(){return n},this.setSessionMinutes=function(e){return n=e},this.setAuthImplName=function(e){return t=e},this.$get=["$injector","$q","$rootScope","$localStorage","$log",function(r,u,i,o,s){var l,c,a,g;return l=r.get(t),g=new(function(){function t(){this.login=e(this.login,this),this.loadCurrentUser=e(this.loadCurrentUser,this),this.userId=null,this.user=null,this.loggedIn=null,this.seenDate=null}return t.prototype.loadCurrentUser=function(){var e,t,r;t=o.securityContext,t&&(r=new Date(o.seenDate),isNaN(r.getTime())?(s.debug("User session date is invalid"),c()):(e=((new Date).getTime()-r.getTime())/1e3/60,n>=e?(this.user=t,this.userId=t.ContactId,this.loggedIn=!0,this.seenDate=new Date):(s.debug("User session has expired"),c()))),a()},t.prototype.login=function(e,t){var n,r;return c(),this.loggedIn=null,n=u.defer(),r=l.login(e,t),r.then(function(e){return n.resolve(e),a()},function(e){return n.reject(e)}),n.promise},t.prototype.logout=function(){return c(),l.logout()},t}()),i.securityContext=g,a=function(){var e;return e=l.getCurrentUser(),e.then(function(e){return e?(s.debug("Received current user from Ministry Platform"),g.user=e,g.userId=e.ContactId,g.loggedIn=!0,g.seenDate=new Date,o.securityContext=e,o.seenDate=g.seenDate):(s.debug("No current user logged in to Ministry Platform"),c())},function(){return s.debug("No current user logged in to Ministry Platform"),c()})},c=function(){return g.userId=null,g.user=null,g.loggedIn=!1,g.seenDate=null,o.securityContext&&delete o.securityContext,o.seenDate?delete o.seenDate:void 0},g}]})}.call(this);